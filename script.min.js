!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=function(){function i(e){t(this,i),this.GAP_MULTIPLIER=40,this.numOfWaves=8,this.waves=[],this.waveSettings=e,e.isSilent||(this.signal=new a(e)),this.phaseOut=!1,this.defunct=!1;for(var n=0;n<this.numOfWaves;n++)this.createWave(n)}return e(i,[{key:"createWave",value:function(t){var e=this,i=Math.round(t/this.numOfWaves*this.waveSettings.duration)*this.GAP_MULTIPLIER;setTimeout(function(){e.phaseOut||(e.waves[t]=new n(e.waveSettings))},i)}},{key:"spreadStep",value:function(){var t=this,e=0;this.waves.forEach(function(i,n){i.spreadStep(),e+=i.currentAlpha,i.defunct&&t.replaceOrClearWave(n)});var i=e;this.signal&&this.signal.changeGain(i),this.waves=this.waves.filter(function(t){return null!==t}),this.phaseOut&&0===this.waves.length&&(this.defunct=!0)}},{key:"replaceOrClearWave",value:function(t){this.phaseOut?this.waves[t]=null:this.waves[t]=new n(this.waveSettings)}}]),i}(),n=function(){function i(e){var n=e.speed,a=e.alphaStep,s=e.red,r=e.green,h=e.blue,u=e.duration,c=e.x,d=e.y;t(this,i),this.speed=n,this.red=s,this.green=r,this.blue=h,this.duration=u,this.alpha=1,this.alphaStep=a,this.frameCount=0,this.radius=0,this.x=c,this.y=d,this.offset=o.offset,this.defunct=!1,this.DEFUNCT_LIMIT=1e-4,this.RADIUS_MODIFIER=1/300,this.GLOW_PERIOD=50}return e(i,[{key:"spreadStep",value:function(){this.increment(),this.paint()}},{key:"increment",value:function(){this.alpha-=this.alphaStep,this.radius+=this.speed,this.frameCount+=1,this.frameCount%=this.GLOW_PERIOD,this.alpha<this.DEFUNCT_LIMIT&&(this.defunct=!0)}},{key:"paint",value:function(){o.ctx.beginPath(),o.ctx.arc(this.x,this.y+this.offset,this.radius,0,2*Math.PI);var t=this.red,e=this.green,i=this.blue,n=this.alpha*this.waveFunction(this.frameCount);this.currentAlpha=n*this.radius*this.RADIUS_MODIFIER,o.ctx.fillStyle="rgba("+t+", "+e+", "+i+", "+n+")",o.ctx.fill(),o.ctx.closePath()}},{key:"waveFunction",value:function(t){var e=t/this.GLOW_PERIOD,i=8;return(Math.sin(2*Math.PI*e)+1)/i}}]),i}(),a=function(){function i(e){var n=e.x,a=e.y;t(this,i),this.MIN_FREQ=20,this.MAX_FREQ=15e3,this.GAIN_MODIFIER=5e-4;var s=Math.log2(this.MAX_FREQ/this.MIN_FREQ),r=(window.innerHeight-a)/window.innerHeight,h=2*((o.width-n)/o.width)-1;this.panner=o.audioCtx.createStereoPanner(),this.panner.pan.value=-h,this.gainNode=o.audioCtx.createGain(),this.oscillator=o.audioCtx.createOscillator(),this.oscillator.type="sine",this.freq=this.MIN_FREQ*Math.pow(2,r*s),this.oscillator.frequency.value=this.freq,this.oscillator.connect(this.gainNode),this.gainNode.connect(this.panner),this.gainNode.gain.value=0,this.panner.connect(o.filter),this.oscillator.start()}return e(i,[{key:"changeGain",value:function(t){this.gainNode.gain.value=this.GAIN_MODIFIER*t}}]),i}(),s=function(){function n(){t(this,n)}return e(n,null,[{key:"createSpotifyWavesSet",value:function(){var t={red:30,green:215,blue:96};o.waves.push(this.createRandomWave({x:o.width,y:o.height/3,color:t,speed:1,alphaStep:1/300,isSilent:!0})),o.waves.push(this.createRandomWave({x:30,y:o.height-40,color:t,speed:1.2,alphaStep:.0025,isSilent:!0}))}},{key:"createRandomWave",value:function(t){var e=t.x,n=t.y,a=t.color,s=t.speed,r=t.alphaStep,h=t.isSilent,u=a||this.generateRandomColor(),c=Object.assign({},{speed:this.isDef(s)?s:.8*Math.random()+.2,alphaStep:this.isDef(r)?r:(.5*Math.random()+.5)/200,duration:400+150*Math.random(),x:this.isDef(e)?e:Math.round(Math.random()*o.width),y:this.isDef(n)?n:Math.round(Math.random()*o.height),isSilent:h},u);return new i(c)}},{key:"isDef",value:function(t){return"undefined"!=typeof t}},{key:"generateRandomColor",value:function(){var t=void 0;do t={red:this.randomColor(),green:this.randomColor(),blue:this.randomColor()};while(t.red+t.green+t.blue<160);return t}},{key:"randomColor",value:function(){var t=10;return Math.round(t+Math.random()*(127-t))}}]),n}(),r=function(){function i(e){t(this,i),this.lastFrameTime=Date.now(),this.GLOBALS=e;var n=25;this.msPerFrame=1e3/n}return e(i,[{key:"startAnimation",value:function(){this.processFrame()}},{key:"processFrame",value:function(){var t=Date.now();t-this.lastFrameTime>this.msPerFrame?(window.requestAnimationFrame(this.drawFrame.bind(this)),this.lastFrameTime=t):window.requestAnimationFrame(this.processFrame.bind(this))}},{key:"drawFrame",value:function(){var t=.7;this.GLOBALS.ctx.fillStyle="rgba(0, 0, 0, "+t+")",this.GLOBALS.ctx.fillRect(0,0,this.GLOBALS.width,this.GLOBALS.height),this.GLOBALS.waves.forEach(function(t){t.spreadStep()}),this.GLOBALS.waves=this.GLOBALS.waves.filter(function(t){return!t.defunct}),window.requestAnimationFrame(this.processFrame.bind(this))}}]),i}(),h=function(){function i(){t(this,i)}return e(i,null,[{key:"setupDimensionsAndCanvas",value:function(){o.height=this.getHeight(),o.width=document.body.clientWidth,o.canvas.width=o.width,o.canvas.height=o.height}},{key:"getHeight",value:function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)}},{key:"setupBackgroundLinkListener",value:function(){var t=this,e=document.getElementById("show-background-link");e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),document.body.classList.add("hide-main-text"),t.fadeOutBackgroundWaves(),t.addCanvasListener(),window.addEventListener("resize",t.setupDimensionsAndCanvas.bind(t)),o.offset=window.pageYOffset})}},{key:"fadeOutBackgroundWaves",value:function(){o.waves.forEach(function(t){t.phaseOut=!0})}},{key:"addCanvasListener",value:function(){var t=this;document.body.addEventListener("click",function(e){document.getElementById("empty-state-text").classList.add("hide");var i=t.getMousePos(e);o.waves.push(s.createRandomWave(i))})}},{key:"getMousePos",value:function(t){return{x:t.pageX-window.pageXOffset,y:t.pageY-window.pageYOffset}}}]),i}(),o={};window.onload=function(){o={offset:0,height:0,width:0,canvas:document.getElementById("background"),audioCtx:new(window.AudioContext||window.webkitAudioContext),waves:[]},o.ctx=o.canvas.getContext("2d"),o.masterGain=o.audioCtx.createGain(),o.masterGain.gain.value=80,o.masterGain.connect(o.audioCtx.destination),o.filter=o.audioCtx.createBiquadFilter(),o.filter.type="highshelf",o.filter.frequency.value=7e3,o.filter.gain.value=-50,o.filter.connect(o.masterGain),h.setupBackgroundLinkListener(),h.setupDimensionsAndCanvas(),s.createSpotifyWavesSet();var t=new r(o);t.startAnimation()}}();

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),Wave=function(){function e(t){_classCallCheck(this,e),this.GAP_MULTIPLIER=40,this.numOfWaves=8,this.waves=[],this.waveSettings=t,t.isSilent||(this.signal=new AudioSignal(t)),this.phaseOut=!1,this.defunct=!1;for(var a=0;a<this.numOfWaves;a++)this.createWave(a)}return _createClass(e,[{key:"createWave",value:function(e){var t=this,a=Math.round(e/this.numOfWaves*this.waveSettings.duration)*this.GAP_MULTIPLIER;setTimeout(function(){t.phaseOut||(t.waves[e]=new WaveComponent(t.waveSettings))},a)}},{key:"spreadStep",value:function(){var e=this,t=0;this.waves.forEach(function(a,i){a.spreadStep(),t+=a.currentAlpha,a.defunct&&e.replaceOrClearWave(i)});var a=t;this.signal&&this.signal.changeGain(a),this.waves=this.waves.filter(function(e){return null!==e}),this.phaseOut&&0===this.waves.length&&(this.defunct=!0)}},{key:"replaceOrClearWave",value:function(e){this.phaseOut?this.waves[e]=null:this.waves[e]=new WaveComponent(this.waveSettings)}}]),e}(),WaveComponent=function(){function e(t){var a=t.speed,i=t.alphaStep,n=t.red,s=t.green,r=t.blue,o=t.duration,h=t.x,u=t.y;_classCallCheck(this,e),this.speed=a,this.red=n,this.green=s,this.blue=r,this.duration=o,this.alpha=1,this.alphaStep=i,this.frameCount=0,this.radius=0,this.x=h,this.y=u,this.offset=GLOBALS.offset,this.defunct=!1,this.DEFUNCT_LIMIT=1e-4,this.RADIUS_MODIFIER=1/300,this.GLOW_PERIOD=50}return _createClass(e,[{key:"spreadStep",value:function(){this.increment(),this.paint()}},{key:"increment",value:function(){this.alpha-=this.alphaStep,this.radius+=this.speed,this.frameCount+=1,this.frameCount%=this.GLOW_PERIOD,this.alpha<this.DEFUNCT_LIMIT&&(this.defunct=!0)}},{key:"paint",value:function(){GLOBALS.ctx.beginPath(),GLOBALS.ctx.arc(this.x,this.y+this.offset,this.radius,0,2*Math.PI);var e=this.red,t=this.green,a=this.blue,i=this.alpha*this.waveFunction(this.frameCount);this.currentAlpha=i*this.radius*this.RADIUS_MODIFIER,GLOBALS.ctx.fillStyle="rgba("+e+", "+t+", "+a+", "+i+")",GLOBALS.ctx.fill(),GLOBALS.ctx.closePath()}},{key:"waveFunction",value:function(e){var t=e/this.GLOW_PERIOD,a=8;return(Math.sin(2*Math.PI*t)+1)/a}}]),e}(),AudioSignal=function(){function e(t){var a=t.x,i=t.y;_classCallCheck(this,e),this.MIN_FREQ=20,this.MAX_FREQ=15e3,this.GAIN_MODIFIER=-5e-4;var n=Math.log2(this.MAX_FREQ/this.MIN_FREQ),s=(window.innerHeight-i)/window.innerHeight,r=2*((GLOBALS.width-a)/GLOBALS.width)-1;this.gainNode=GLOBALS.audioCtx.createGain(),this.gainNode.gain.value=0,this.oscillator=GLOBALS.audioCtx.createOscillator(),this.oscillator.type="sine",this.freq=this.MIN_FREQ*Math.pow(2,s*n),this.oscillator.frequency.value=this.freq,this.oscillator.connect(this.gainNode),GLOBALS.audioCtx.createStereoPanner?(this.panner=GLOBALS.audioCtx.createStereoPanner(),this.panner.pan.value=-r,this.gainNode.connect(this.panner),this.panner.connect(GLOBALS.filter)):this.gainNode.connect(GLOBALS.filter),this.oscillator.start()}return _createClass(e,[{key:"changeGain",value:function(e){this.gainNode.gain.value=this.GAIN_MODIFIER*e}}]),e}(),WaveGenerator=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createSpotifyWavesSet",value:function(){var e={red:30,green:215,blue:96};GLOBALS.waves.push(this.createRandomWave({x:GLOBALS.width,y:GLOBALS.height/3,color:e,speed:1,alphaStep:1/300,isSilent:!0})),GLOBALS.waves.push(this.createRandomWave({x:30,y:GLOBALS.height-40,color:e,speed:1.2,alphaStep:.0025,isSilent:!0}))}},{key:"createRandomWave",value:function(e){var t=e.x,a=e.y,i=e.color,n=e.speed,s=e.alphaStep,r=e.isSilent,o=i||this.generateRandomColor(),h=Object.assign({},{speed:this.isDef(n)?n:.8*Math.random()+.2,alphaStep:this.isDef(s)?s:(.5*Math.random()+.5)/200,duration:400+150*Math.random(),x:this.isDef(t)?t:Math.round(Math.random()*GLOBALS.width),y:this.isDef(a)?a:Math.round(Math.random()*GLOBALS.height),isSilent:r},o);return new Wave(h)}},{key:"isDef",value:function(e){return"undefined"!=typeof e}},{key:"generateRandomColor",value:function(){var e=void 0;do e={red:this.randomColor(),green:this.randomColor(),blue:this.randomColor()};while(e.red+e.green+e.blue<160);return e}},{key:"randomColor",value:function(){var e=10;return Math.round(e+Math.random()*(127-e))}}]),e}(),AnimationRunner=function(){function e(t){_classCallCheck(this,e),this.lastFrameTime=Date.now(),this.GLOBALS=t;var a=25;this.msPerFrame=1e3/a}return _createClass(e,[{key:"startAnimation",value:function(){this.processFrame()}},{key:"processFrame",value:function(){var e=Date.now();e-this.lastFrameTime>this.msPerFrame?(window.requestAnimationFrame(this.drawFrame.bind(this)),this.lastFrameTime=e):window.requestAnimationFrame(this.processFrame.bind(this))}},{key:"drawFrame",value:function(){var e=.7;this.GLOBALS.ctx.fillStyle="rgba(0, 0, 0, "+e+")",this.GLOBALS.ctx.fillRect(0,0,this.GLOBALS.width,this.GLOBALS.height),this.GLOBALS.waves.forEach(function(e){e.spreadStep()}),this.GLOBALS.waves=this.GLOBALS.waves.filter(function(e){return!e.defunct}),window.requestAnimationFrame(this.processFrame.bind(this))}}]),e}(),Page=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setupDimensionsAndCanvas",value:function(){GLOBALS.height=this.getHeight(),GLOBALS.width=document.body.clientWidth,GLOBALS.canvas.width=GLOBALS.width,GLOBALS.canvas.height=GLOBALS.height}},{key:"getHeight",value:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}},{key:"setupBackgroundLinkListener",value:function(){var e=this,t=document.getElementById("show-background-link");t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),document.body.classList.add("hide-main-text"),e.fadeOutBackgroundWaves(),e.addCanvasListener(),window.addEventListener("resize",e.setupDimensionsAndCanvas.bind(e)),GLOBALS.offset=window.pageYOffset})}},{key:"fadeOutBackgroundWaves",value:function(){GLOBALS.waves.forEach(function(e){e.phaseOut=!0})}},{key:"addCanvasListener",value:function(){var e=this;document.body.addEventListener("click",function(t){document.getElementById("empty-state-text").classList.add("hide");var a=e.getMousePos(t);GLOBALS.waves.push(WaveGenerator.createRandomWave(a))})}},{key:"getMousePos",value:function(e){return{x:e.pageX-window.pageXOffset,y:e.pageY-window.pageYOffset}}}]),e}(),GLOBALS={};window.onload=function(){GLOBALS={offset:0,height:0,width:0,canvas:document.getElementById("background"),audioCtx:new(window.AudioContext||window.webkitAudioContext),waves:[]},GLOBALS.ctx=GLOBALS.canvas.getContext("2d"),GLOBALS.masterGain=GLOBALS.audioCtx.createGain(),GLOBALS.masterGain.gain.value=80,GLOBALS.masterGain.connect(GLOBALS.audioCtx.destination),GLOBALS.filter=GLOBALS.audioCtx.createBiquadFilter(),GLOBALS.filter.type="highshelf",GLOBALS.filter.frequency.value=7e3,GLOBALS.filter.gain.value=-50,GLOBALS.filter.connect(GLOBALS.masterGain),Page.setupBackgroundLinkListener(),Page.setupDimensionsAndCanvas(),WaveGenerator.createSpotifyWavesSet();var e=new AnimationRunner(GLOBALS);e.startAnimation()};
